% Logic/scripting
\usepackage{ifthen}
\usepackage{pgffor}
\usepackage{etoolbox}
\usepackage{parselines}
\usepackage{environ}
\usepackage{keyval}
\usepackage{listofitems}
\usepackage{forloop}
\usepackage{calc}
\usepackage{xstring}
\usepackage{changepage}
\usepackage{scrextend}
\usepackage{expl3}

% Math
\makeatletter
\ifthenelse{\isundefined{\lefteqs}}{
\usepackage{amsmath}
\usepackage{mathtools}
}{
\usepackage[fleqn]{amsmath}
\usepackage[fleqn]{mathtools}
}
\usepackage{amssymb}
\@ifclassloaded{autart}{}{\usepackage{amsthm}}
\makeatother
\usepackage{thmtools}
\usepackage{ar}
\usepackage{empheq}
\usepackage{mathrsfs}
\usepackage{bm}

\makeatletter
\let\ltxxlabel\ltx@label
\makeatother

% Colors
\usepackage{color}
\makeatletter
\@ifclassloaded{beamer}{}{
\usepackage[table]{xcolor}}
\makeatother

% Figures
\usepackage{graphicx}
\makeatletter
\@ifclassloaded{UWThesis/uwthesis}{
\usepackage{subfig}
}{\usepackage{subcaption}}
\makeatother
\usepackage{caption}

% Tables
\usepackage{tabularx}
\usepackage{adjustbox}
\usepackage{multicol}
\usepackage{diagbox} % \diagbox{rows}{columns} with slash in between
\usepackage{varwidth} % V{max_width} variable-width cell type
\usepackage{makecell} % \makecell[l|r|c]{line 1 \\ line 2}
\usepackage{arydshln}

% Document elements
\usepackage{tikz}
\usepackage{tikz-3dplot}
\makeatletter
\@ifclassloaded{standalone}{}{\usepackage[tikz]{mdframed}}
\makeatother
\usepackage{tocloft}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{algorithm, algorithmicx}
\usepackage{algpseudocode}%[noend]
\usepackage[many]{tcolorbox}
\usepackage[binary-units=true]{siunitx}
\usepackage{chemformula}
\usepackage[normalem]{ulem}
\usepackage{cancel}
\usepackage{accents}
\makeatletter
\@ifclassloaded{beamer}{\usepackage{multimedia}}{}
\makeatother
\usepackage{lipsum}
\usepackage{mfirstuc}
\usepackage{import}
\usepackage{nicematrix}
\usepackage{bibentry} % use \bibentry{...} for in-text citation
\makeatletter
\ifthenelse{\isundefined{\natbiboptions}}{
%\usepackage{lscape} % production (non-rotated PDF pages)
%\usepackage{pdflscape} % writing (rotated PDF pages, don't need to twist head)
\def\natbiboptions{numbers,sort}
}{}
\ifthenelse{\isundefined{\nobibpkg}}{
\@ifclassloaded{ieeeconf}{}{
\@ifclassloaded{elsarticle}{}{\usepackage[\natbiboptions]{natbib}\nobibliography*}}
}{}
\makeatother

% Layout
\usepackage{float}
\usepackage{afterpage}
\ifthenelse{\isundefined{\landscapemode}}{
%\usepackage{lscape} % production (non-rotated PDF pages)
%\usepackage{pdflscape} % writing (rotated PDF pages, don't need to twist head)
\def\landscapemode{pdflscape}
}{}
\usepackage{\landscapemode} % writing (rotated PDF pages, don't need to twist head)
\usepackage{varwidth}
\usepackage{nomencl}
\usepackage{longtable}
\usepackage{marginnote}
\makeatletter
\@ifclassloaded{beamer}{}{
\@ifclassloaded{autart}{}{
\@ifclassloaded{standalone}{}{
\@ifclassloaded{ieeeconf}{}{
\usepackage[explicit]{titlesec}
}}}}
\makeatother
\usepackage{soul}
\usepackage{stackengine}
\usepackage{scalerel}
\usepackage{lastpage}
\usepackage{fancyhdr}
\usepackage{nameref}

% Referencing
\makeatletter
\@ifclassloaded{UWThesis/uwthesis}{}{\usepackage[breaklinks=true]{hyperref}
% Fix the following error from sometimes appearing:
%   latex pdfTeX error (ext4): \pdfendlink ended up in different nesting level than \pdfstartlink.
% Fix from David Carlisle's comment on https://github.com/latex3/hyperref/issues/19
\patchcmd\@combinedblfloats{\box\@outputbox}{\unvbox\@outputbox}{}{%
\errmessage{\noexpand\@combinedblfloats could not be patched}%
}%
}
\makeatother

% General
\usepackage{xspace}
